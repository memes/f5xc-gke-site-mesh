# Autogenerated by foundations Terraform
# spell-checker: disable
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../../f5xc-site/upstream
  - Kptfile
  - resourcegroup.yaml

commonAnnotations: ${jsonencode(annotations)}
configMapGenerator:
  - name: vpm-cfg
    namespace: ves-system
    behavior: replace
    files:
      - config.yaml=vpm-config.yaml
# Apply labels to the metadata of all resources, but do not update selectors,
# etc.; commonLabels builtin will update the ver-nodeport-ver-N selectors which
# will then fail to match resources dynamically added by vp-manager during
# registration.
transformers:
  - |-
    apiVersion: builtin
    kind: LabelTransformer
    metadata:
      name: metadata-labeler
    labels: ${jsonencode(labels)}
    fieldSpecs:
      - path: metadata/labels
        create: true
%{ if coalesce(vip, "unspecified") != "unspecified" ~}
# Reconfigure ver-loadbalancer service to use an L4 LB on the reserved public
# IP address.
patches:
  - target:
      group: ''
      version: v1
      kind: Service
      name: ver-public
      namespace: ves-system
    patch: |-
      - op: add
        path: /spec/loadBalancerIP
        value: ${vip}
%{ endif ~}
